IF(APPLE)
    SET(CMAKE_C_COMPILER /usr/local/bin/gcc-4.5)
    SET(CMAKE_CXX_COMPILER /usr/local/bin/g++-4.5)
ENDIF()

CMAKE_MINIMUM_REQUIRED( VERSION 2.8.7 )
MARK_AS_ADVANCED(CMAKE_BACKWARDS_COMPATIBILITY)
###########################################################################
#Project-specific Configuration
###########################################################################

#Set a project name
SET(PROJECT_NAME water_app)
PROJECT(${PROJECT_NAME})

#Set Nimbus root and prtobuf files directory
SET(NIMBUS_ROOT ${PROJECT_SOURCE_DIR}/../..)

# Remove all the DBG lines during compile time.
# add_definitions(-D_NIMBUS_NO_DBG)

include_directories(${NIMBUS_ROOT})
LINK_DIRECTORIES(${NIMBUS_ROOT})

######################################################
# Custom commands to autogenerate data_def           #
# and reg_def                                        #
######################################################
set(APPLICATION_UTILS_DIR "${NIMBUS_ROOT}/application_utils")
set(DATA_DEF_PRODUCER_PY "${APPLICATION_UTILS_DIR}/generate_data_def.py")
set(REG_DEF_PRODUCER_PY "${APPLICATION_UTILS_DIR}/generate_region_def.py")
set(DATA_DEF_CC "${PROJECT_SOURCE_DIR}/data_def.cc")
set(DATA_DEF_H "${PROJECT_SOURCE_DIR}/data_def.h")
set(DATA_CONFIG "${PROJECT_SOURCE_DIR}/data_config")
set(REG_DEF_CC "${PROJECT_SOURCE_DIR}/reg_def.cc")
set(REG_DEF_H "${PROJECT_SOURCE_DIR}/reg_def.h")
set(REG_CONFIG "${PROJECT_SOURCE_DIR}/regions_config")

add_custom_command(
  OUTPUT ${DATA_DEF_CC} ${DATA_DEF_H}
  COMMAND "python"
  ARGS "${DATA_DEF_PRODUCER_PY}"
  DEPENDS ${DATA_CONFIG}
  WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
  COMMENT "Producing data def through python autogenerator")

add_custom_command(
  OUTPUT ${REG_DEF_CC} ${REG_DEF_H}
  COMMAND "python"
  ARGS "${REG_DEF_PRODUCER_PY}"
  DEPENDS ${REG_CONFIG}
  WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
  COMMENT "Producing reg def through python autogenerator")

set(${PROJECT_NAME}_ADDITIONAL_PROJECT_SOURCE_FILES
  ${DATA_DEF_CC}
  ${DATA_DEF_H}
  ${REG_DEF_CC}
  ${REG_DEF_H})


######################################################
# Manually list your cpp and h files here - do NOT   #
# use GLOB/GLOB_RECURSE                              #
######################################################
#Add flags
add_definitions(-DDUMP_NDATA=FALSE )

#Manually list your cpp and h files here - do NOT use GLOB/GLOB_RECURSE
SET(${PROJECT_NAME}_cpp
    # autogenerated files
    ${DATA_DEF_CC}
    ${REG_DEF_CC}
    # end autogenerated files
    ${PROJECT_SOURCE_DIR}/app_utils.cc
    ${PROJECT_SOURCE_DIR}/job_barrier.cc
    ${PROJECT_SOURCE_DIR}/app_data_face_array.cc
    ${PROJECT_SOURCE_DIR}/app_data_particle_levelset_evolution.cc
    ${PROJECT_SOURCE_DIR}/app_data_prototypes.cc
    ${PROJECT_SOURCE_DIR}/app_data_scalar_array.cc
    ${PROJECT_SOURCE_DIR}/app_data_compressed_scalar_array.cc
    ${PROJECT_SOURCE_DIR}/data_face_array.cc
    ${PROJECT_SOURCE_DIR}/data_particle_array.cc
    ${PROJECT_SOURCE_DIR}/data_scalar_array.cc
    ${PROJECT_SOURCE_DIR}/data_compressed_scalar_array.cc
    ${PROJECT_SOURCE_DIR}/job_initialize.cc
    ${PROJECT_SOURCE_DIR}/job_loop_frame.cc
    ${PROJECT_SOURCE_DIR}/job_loop_iteration.cc
    ${PROJECT_SOURCE_DIR}/job_loop_iteration_part_two.cc
    ${PROJECT_SOURCE_DIR}/job_adjust_phi.cc
    ${PROJECT_SOURCE_DIR}/job_calculate_dt.cc
    ${PROJECT_SOURCE_DIR}/job_delete_particles.cc
    ${PROJECT_SOURCE_DIR}/job_main.cc
    ${PROJECT_SOURCE_DIR}/job_modify_levelset_part_one.cc
    ${PROJECT_SOURCE_DIR}/job_modify_levelset_part_two.cc
    ${PROJECT_SOURCE_DIR}/job_make_signed_distance.cc
    ${PROJECT_SOURCE_DIR}/job_reincorporate_removed_particles.cc
    ${PROJECT_SOURCE_DIR}/job_update_ghost_velocities.cc
    ${PROJECT_SOURCE_DIR}/job_extrapolate_phi.cc
    ${PROJECT_SOURCE_DIR}/job_advect_phi.cc
    ${PROJECT_SOURCE_DIR}/job_step_particles.cc
    ${PROJECT_SOURCE_DIR}/job_advect_removed_particles.cc
    ${PROJECT_SOURCE_DIR}/job_advect_v.cc
    ${PROJECT_SOURCE_DIR}/job_apply_forces.cc
    ${PROJECT_SOURCE_DIR}/job_extrapolation.cc
    ${PROJECT_SOURCE_DIR}/job_synchronize_particles.cc
    ${PROJECT_SOURCE_DIR}/job_write_output.cc
    ${PROJECT_SOURCE_DIR}/job_reseed_particles.cc
    ${PROJECT_SOURCE_DIR}/nimbus_thread_queue.cc
    ${PROJECT_SOURCE_DIR}/physbam_tools.cc
    ${PROJECT_SOURCE_DIR}/physbam_utils.cc
    ${PROJECT_SOURCE_DIR}/static_config_collision_body.cc
    ${PROJECT_SOURCE_DIR}/static_config_force.cc
    ${PROJECT_SOURCE_DIR}/static_config_u_interface.cc
    ${PROJECT_SOURCE_DIR}/static_config_valid_mask.cc
    ${PROJECT_SOURCE_DIR}/water_app.cc
    ${PROJECT_SOURCE_DIR}/water_driver.cc
    ${PROJECT_SOURCE_DIR}/water_driver_initializers.cc
    ${PROJECT_SOURCE_DIR}/water_example.cc
    ${PROJECT_SOURCE_DIR}/water_sources.cc
    ${PROJECT_SOURCE_DIR}/projection/app_data_array_m2c.cc
    ${PROJECT_SOURCE_DIR}/projection/app_data_sparse_matrix.cc
    ${PROJECT_SOURCE_DIR}/projection/app_data_vector.cc
    ${PROJECT_SOURCE_DIR}/projection/app_data_raw_grid_array.cc
    ${PROJECT_SOURCE_DIR}/projection/data_raw_grid_array.cc
    ${PROJECT_SOURCE_DIR}/projection/data_raw_array_m2c.cc
    ${PROJECT_SOURCE_DIR}/projection/data_raw_vector_nd.cc
    ${PROJECT_SOURCE_DIR}/projection/data_sparse_matrix.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_main.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_transform_pressure.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_calculate_boundary_condition_part_one.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_calculate_boundary_condition_part_two.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_construct_matrix.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_wrapup.cc
    ${PROJECT_SOURCE_DIR}/projection/laplace_solver_wrapper.cc
    ${PROJECT_SOURCE_DIR}/projection/projection_driver.cc
    ${PROJECT_SOURCE_DIR}/projection/projection_driver_caching.cc
    ${PROJECT_SOURCE_DIR}/projection/projection_helper.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_local_initialize.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_global_initialize.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_loop_iteration.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_one.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_reduce_rho.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_two.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_three.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_reduce_alpha.cc
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_four.cc
    )
SET(${PROJECT_NAME}_h
    # autogenerated files
    ${DATA_DEF_H}
    ${REG_DEF_H}
    # end autogenerated files
    ${PROJECT_SOURCE_DIR}/app_utils.h
    ${PROJECT_SOURCE_DIR}/job_barrier.h
    ${PROJECT_SOURCE_DIR}/app_data_data_include.h
    ${PROJECT_SOURCE_DIR}/app_data_face_array.h
    ${PROJECT_SOURCE_DIR}/app_data_options.h
    ${PROJECT_SOURCE_DIR}/app_data_particle_levelset_evolution.cc
    ${PROJECT_SOURCE_DIR}/app_data_prototypes.h
    ${PROJECT_SOURCE_DIR}/app_data_compressed_scalar_array.h
    ${PROJECT_SOURCE_DIR}/app_data_scalar_array.h
    ${PROJECT_SOURCE_DIR}/data_include.h
    ${PROJECT_SOURCE_DIR}/data_names.h
    ${PROJECT_SOURCE_DIR}/data_face_array.h
    ${PROJECT_SOURCE_DIR}/data_particle_array.h
    ${PROJECT_SOURCE_DIR}/data_scalar_array.h
    ${PROJECT_SOURCE_DIR}/data_compressed_scalar_array.h
    ${PROJECT_SOURCE_DIR}/job_include.h
    ${PROJECT_SOURCE_DIR}/job_names.h
    ${PROJECT_SOURCE_DIR}/job_initialize.h
    ${PROJECT_SOURCE_DIR}/job_loop_frame.h
    ${PROJECT_SOURCE_DIR}/job_loop_iteration.h
    ${PROJECT_SOURCE_DIR}/job_loop_iteration_part_two.h
    ${PROJECT_SOURCE_DIR}/job_adjust_phi.h
    ${PROJECT_SOURCE_DIR}/job_calculate_dt.h
    ${PROJECT_SOURCE_DIR}/job_delete_particles.h
    ${PROJECT_SOURCE_DIR}/job_main.h
    ${PROJECT_SOURCE_DIR}/job_modify_levelset_part_one.h
    ${PROJECT_SOURCE_DIR}/job_modify_levelset_part_two.h
    ${PROJECT_SOURCE_DIR}/job_make_signed_distance.h
    ${PROJECT_SOURCE_DIR}/job_reincorporate_removed_particles.h
    ${PROJECT_SOURCE_DIR}/job_update_ghost_velocities.h
    ${PROJECT_SOURCE_DIR}/job_extrapolate_phi.h
    ${PROJECT_SOURCE_DIR}/job_advect_phi.h
    ${PROJECT_SOURCE_DIR}/job_step_particles.h
    ${PROJECT_SOURCE_DIR}/job_advect_removed_particles.h
    ${PROJECT_SOURCE_DIR}/job_advect_v.h
    ${PROJECT_SOURCE_DIR}/job_apply_forces.h
    ${PROJECT_SOURCE_DIR}/job_extrapolation.h
    ${PROJECT_SOURCE_DIR}/job_synchronize_particles.h
    ${PROJECT_SOURCE_DIR}/job_write_output.h
    ${PROJECT_SOURCE_DIR}/job_reseed_particles.h
    ${PROJECT_SOURCE_DIR}/nimbus_thread_queue.h
    ${PROJECT_SOURCE_DIR}/options.h
    ${PROJECT_SOURCE_DIR}/parameters.h
    ${PROJECT_SOURCE_DIR}/physbam_include.h
    ${PROJECT_SOURCE_DIR}/physbam_tools.h
    ${PROJECT_SOURCE_DIR}/physbam_utils.h
    ${PROJECT_SOURCE_DIR}/static_config_collision_body.h
    ${PROJECT_SOURCE_DIR}/static_config_force.h
    ${PROJECT_SOURCE_DIR}/static_config_valid_mask.h
    ${PROJECT_SOURCE_DIR}/static_config_u_interface.h
    ${PROJECT_SOURCE_DIR}/water_app.h
    ${PROJECT_SOURCE_DIR}/water_driver.h
    ${PROJECT_SOURCE_DIR}/water_example.h
    ${PROJECT_SOURCE_DIR}/water_sources.h
    ${PROJECT_SOURCE_DIR}/projection/app_data_array_m2c.h
    ${PROJECT_SOURCE_DIR}/projection/app_data_sparse_matrix.h
    ${PROJECT_SOURCE_DIR}/projection/app_data_vector.h
    ${PROJECT_SOURCE_DIR}/projection/app_data_raw_grid_array.h
    ${PROJECT_SOURCE_DIR}/projection/data_raw_grid_array.h
    ${PROJECT_SOURCE_DIR}/projection/data_raw_array_m2c.h
    ${PROJECT_SOURCE_DIR}/projection/data_raw_vector_nd.h
    ${PROJECT_SOURCE_DIR}/projection/data_sparse_matrix.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_main.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_transform_pressure.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_calculate_boundary_condition_part_one.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_calculate_boundary_condition_part_two.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_construct_matrix.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_wrapup.h
    ${PROJECT_SOURCE_DIR}/projection/laplace_solver_wrapper.h
    ${PROJECT_SOURCE_DIR}/projection/translator_util.h
    ${PROJECT_SOURCE_DIR}/projection/projection_driver.h
    ${PROJECT_SOURCE_DIR}/projection/projection_helper.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_local_initialize.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_global_initialize.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_loop_iteration.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_one.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_reduce_rho.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_two.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_three.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_reduce_alpha.h
    ${PROJECT_SOURCE_DIR}/projection/job_projection_step_four.h
    )

#List the libraries you want to link against - including a higher-level
#library automatically includes the lower-level ones
SET(LIBRARIES_TO_LINK PhysBAM_Rendering-OpenGL)
SET(PROTO_LIB protobuf)
SET(NIMBUS_LIB nimbus)
SET(BOOST_THREAD boost_thread)
SET(BOOST_SYSTEM boost_system)
LIST(APPEND LIBRARIES_TO_LINK ${PROTO_LIB})
LIST(APPEND LIBRARIES_TO_LINK ${NIMBUS_LIB})
LIST(APPEND LIBRARIES_TO_LINK ${BOOST_THREAD})
LIST(APPEND LIBRARIES_TO_LINK ${BOOST_SYSTEM})

#you can force app_data variables to be on or off here
#SET(PHYSBAM_USE_CUDA ON CACHE BOOL ON FORCE)

INCLUDE(${NIMBUS_ROOT}/application/physbam-lib/Scripts/CMake/Nimbus_Application_Library.cmake)
include_directories(${NIMBUS_ROOT}/leveldb/include/)
