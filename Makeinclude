# Root includes for all Nimbus Makefiles

# Detect if we are running Darwin -- should be replaced by autoconf eventually
ifeq ($(findstring darwin, ${OSTYPE}), darwin) 
  OS_DARWIN=TRUE
else
ifeq ($(findstring Darwin, $(shell uname)), Darwin)
  OS_DARWIN=TRUE  
endif
endif

# Detect if we are running Linux -- should be replaced by autoconf eventually
ifeq (${OSTYPE}, linux)
  OS_LINUX=TRUE
else
ifeq ($(findstring Linux, $(shell uname)), Linux)
  OS_LINUX=TRUE
endif
endif


# LDIR is needed for rpath directives for dynamic loading
LDIR = ${NIMBUS_ROOT}

CPP = g++
# Flags for all cpp invocations
CFLAGS = -Wall -g -pg -O0
# CFLAGS += -D_NIMBUS_NO_DBG
# CFLAGS += -D_NIMBUS_NO_LOG

# For reasons I do not understand need to disable two-level loading namespace
# optimizations under Darwin -pal
ifdef OS_DARWIN
  CFLAGS  += -Wl,-no_implicit_dylibs
endif

# -I params for all cpp invocations
IFLAGS   = -I/opt/local/include # Include MacPorts includes
IFLAGS  += -I/usr/local/include # For protobufs
IFLAGS  += -I${NIMBUS_ROOT}

# -l params for linking invocation
LFLAGS   =                                      

# -L params for linking invocation
LDFLAGS += -L/opt/local/lib # Link with MacPorts libraries
LDFLAGS += -L${NIMBUS_ROOT}/ # Link with Nimbus libraries

# -rpath tells executable where to look for libraries; without it executables
# do not find Nimbus libraries. -pal
LDFLAGS += -Wl,-rpath ${NIMBUS_ROOT}





# Checking rules

NIMBUS_CCLINT = ${NIMBUS_ROOT}/tools/cpplint.py
NIMBUS_FILENAMES = ${NIMBUS_ROOT}/tools/cppfiles.sh

fcheck:
	@${NIMBUS_FILENAMES}

lint:
	@${NIMBUS_CCLINT} --root=src *.h *.cc

check: fcheck lint

clean-files:
	\rm -f *.o *~ \#*

